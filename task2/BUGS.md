# Баг-репорты

## Критичность: Critical

### 1: API: `GET /api/1/item/:id` возвращает массив `[]` вместо одного объекта `{}`

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **Critical** |
| **Шаги для воспроизведения** | 1. Создать объявление через `POST /api/1/item` и получить его `{id}`.<br>2. Отправить `GET` запрос на эндпоинт `/api/1/item/{id}` с полученным `{id}`.<br>3. Проанализировать структуру полученного JSON в теле ответа. |
| **Фактический результат**    | Сервер возвращает статус `200 OK` и тело ответа в виде массива, содержащего один объект: `[ { "id": "...", ... } ]`. |
| **Ожидаемый результат**      | Сервер должен возвращать статус `200 OK` и тело ответа в виде **одного объекта**: `{ "id": "...", ... }`. |

---

## Критичность: High

### 2: API: `DELETE /api/2/item/:id` возвращает 404 с телом ошибки 500 при попытке удаления несуществующего объявления

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **High** |
| **Шаги для воспроизведения** | 1. Взять любой валидный по формату, но не существующий в системе UUID.<br>2. Отправить `DELETE` запрос на `/api/2/item/{несуществующий_uuid}`.<br>3. Сравнить HTTP статус-код ответа и поле `status` в теле ответа. |
| **Фактический результат**    | Сервер возвращает HTTP статус-код `404 Not Found`, но в теле ответа поле `status` содержит значение `"500"`. |
| **Ожидаемый результат**      | Сервер должен возвращать HTTP статус-код `404 Not Found`, и поле `status` в теле ответа также должно содержать `"404"`. |

### 3: API: Некорректная структура тела ответа при ошибках валидации (`messages` пустое)

| Поле                         | Значение                                                                                                                                                                                                                                          |
|:-----------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Приоритет**                | **High**                                                                                                                                                                                                                                          |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item` с несколькими невалидными полями (например, `price` - строка, `name` - `null`).<br>2. Проанализировать тело ответа.                                                                                   |
| **Фактический результат**    | Объект `messages` в теле ответа является пустым (`{}`) или `null`. Общая информация об ошибке находится в поле `message`.                                                                                                                         |
| **Ожидаемый результат**      | Поле `messages` должно содержать объект с детализацией ошибок по каждому невалидному полю (например, `{"price": "должно быть числом", "name": "не может быть null"}`). Поле `message` должно содержать общую ошибку, например "Ошибка валидации". |

### 4: API: `POST /api/1/item` позволяет создавать объявления с отрицательной ценой

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **High** |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item` с валидными данными, но с отрицательным значением в поле `price` (например, `-100`). |
| **Фактический результат**    | Сервер возвращает `200 OK` и создает объявление с отрицательной ценой. |
| **Ожидаемый результат**      | Сервер должен вернуть `400 Bad Request` с сообщением об ошибке, что цена не может быть отрицательной. |

### 5: API: `POST /api/1/item` не создает объявление с `price: 0`

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **High** |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item` с валидными данными, указав в поле `price` значение `0`. |
| **Фактический результат**    | Сервер возвращает ошибку `400 Bad Request`. |
| **Ожидаемый результат**      | Сервер должен вернуть `200 OK` и успешно создать объявление с нулевой ценой, так как это валидный бизнес-сценарий ("Отдам бесплатно"). |

### 6: API: `POST /api/1/item` позволяет выходить за допустимый диапазон `sellerId`

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **High** |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item`, указав `sellerId: 111110`.<br>2. Отправить второй запрос, указав `sellerId: 1000000`. |
| **Фактический результат**    | В обоих случаях сервер возвращает `200 OK` и создает объявления. |
| **Ожидаемый результат**      | В обоих случаях сервер должен возвращать `400 Bad Request` с сообщением о том, что `sellerId` находится вне допустимого диапазона (111111-999999). |

### 7: API: `POST /api/1/item` позволяет создавать объявления с отрицательными значениями в `statistics`

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **High** |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item`, указав в блоке `statistics` отрицательное значение для любого из полей (например, `viewCount: -5`). |
| **Фактический результат**    | Сервер возвращает `200 OK` и создает объявление с некорректной статистикой. |
| **Ожидаемый результат**      | Сервер должен вернуть `400 Bad Request` с сообщением об ошибке, что значения в статистике не могут быть отрицательными. |


### 8: API: `POST /api/1/item` не создает объявления с нулевыми значениями в `statistics`

| Поле                         | Значение                                                                                                                                  |
|:-----------------------------|:------------------------------------------------------------------------------------------------------------------------------------------|
| **Приоритет**                | **High**                                                                                                                                  |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item` с валидными данными, но с нулевыми значениями в `statistics` (`"likes": 0`, и т.д.).          |
| **Фактический результат**    | Сервер возвращает ошибку `400 Bad Request`.                                                                                               |
| **Ожидаемый результат**      | Сервер должен вернуть `200 OK`. Новое объявление должно иметь нулевую статистику, что является логичным для только что созданного товара. |

### 9: API: `POST /api/1/item` возвращает некорректную структуру ответа при успехе (200 OK)

| Поле                         | Значение                                                                                                                                                                                                                                                                                                                                            |
|:-----------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Приоритет**                | **High**                                                                                                                                                                                                                                                                                                                                            |
| **Шаги для воспроизведения** | 1. Сформировать и отправить `POST` запрос на `/api/1/item` с полностью валидным телом.<br>2. Убедиться, что ответ пришел со статусом `200 OK`.<br>3. Проанализировать структуру JSON в теле ответа.                                                                                                                                                 |
| **Фактический результат**    | Тело ответа представляет собой простой объект со строкой статуса, включающей в себя ID:<br>```{ "status": "Сохранили объявление - 7c8d8492-56f4-4fff-ad63-bc10b802955f" } ```                                                                                                                                                                       |
| **Ожидаемый результат**      | Тело ответа должно быть полноценным JSON-объектом созданного объявления, в соответствии со схемой в документации. Например:<br>```{ "id": "7c8d8492-56f4-4fff-ad63-bc10b802955f", "sellerId": 111303, "name": "Объявление", "price": 100, "createdAt": "2025-11-17T12:00:00Z", "statistics": { "likes": 10, "viewCount": 11, "contacts": 12 } } ``` |

### 10: API: Некорректная структура ответа при ошибке типа данных (поле `status` содержит текст ошибки)

| Поле                         | Значение                                                                                                                                                                                                   |
|:-----------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Приоритет**                | **High**                                                                                                                                                                                                   |
| **Шаги для воспроизведения** | 1. Сформировать `POST` запрос на `/api/1/item`.<br>2. В одном из полей указать значение неверного типа (например, `price: "сто"`).<br>3. Отправить запрос и проанализировать структуру JSON в теле ответа. |
| **Фактический результат**    | Сервер возвращает `400 Bad Request`. В теле ответа поле `status` содержит **текст сообщения об ошибке**, а поле `message` - пустое.                                                                        |
| **Ожидаемый результат**      | Сервер должен вернуть `400 Bad Request` со стандартной структурой ошибки. Поле `status` должно содержать **код ошибки**, а `message` и `messages` - детализацию.                                           |

---

## Критичность: Medium

### 11: API: `GET /api/2/statistic/:id` возвращает 404 с телом ошибки 400 при некорректном формате `id`

| Поле                         | Значение                                                                                                                                                                                                                          |
|:-----------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Приоритет**                | **Medium**                                                                                                                                                                                                                        |
| **Шаги для воспроизведения** | 1. Отправить `GET` запрос на `/api/2/statistic/{id}`, подставив некорректный ID (например, "test").<br>2. Сравнить HTTP статус-код и код в теле ответа.                                                                           |
| **Фактический результат**    | Сервер возвращает HTTP статус-код `404 Not Found`, но в теле ответа поле `code` содержит значение `400`.                                                                                                                          |
| **Ожидаемый результат**      | Если проблема в **формате** `id`, ожидается статус `400 Bad Request` и в коде, и в теле. Если проблема в **несуществующем маршруте** (как в `a/`), ожидается `404 Not Found` и в коде, и в теле. Ответ должен быть консистентным. |

### 12: API: `POST /api/1/item` создает объявление с `name`, состоящим из пробелов

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **Medium** |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item`, указав в поле `name` строку из нескольких пробелов: `" "`. |
| **Фактический результат**    | Сервер возвращает `200 OK` и создает объявление с "пустым" названием. |
| **Ожидаемый результат**      | Сервер должен вернуть `400 Bad Request` с сообщением о том, что поле `name` не может быть пустым или состоять только из пробелов. |

### 13: API: `POST /api/1/item` создает объявление с `name`, состоящим из спецсимволов

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **Medium** |
| **Шаги для воспроизведения** | 1. Отправить `POST` запрос на `/api/1/item`, указав в поле `name` строку из спецсимволов: `"@&#"`. |
| **Фактический результат**    | Сервер возвращает `200 OK` и создает объявление. |
| **Ожидаемый результат**      | Согласно требованиям, сервер должен вернуть `400 Bad Request` с сообщением о недопустимых символах в названии. |

### 14: API возвращает HTML вместо JSON при попытке Path Traversal атаки

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **Medium** |
| **Шаги для воспроизведения** | 1. Взять любой эндпоинт, принимающий ID в качестве параметра пути, например `GET /api/1/item/:id`.<br>2. В качестве ID подставить строку, имитирующую атаку Path Traversal: `../../../../../a`.<br>3. Отправить запрос и проанализировать тело ответа. |
| **Фактический результат**    | Сервер возвращает HTTP статус-код `400 Bad Request`. Тело ответа представляет собой HTML-страницу. |
| **Ожидаемый результат**      | Сервер должен вернуть HTTP статус-код `400 Bad Request` и **тело ответа в стандартном для API формате JSON**, соответствующем схеме ошибок. |

---

## Критичность: Low

### 15: Документация: Некорректное описание (`description`) для успешного ответа `POST /api/1/item`

| Поле                         | Значение |
|:-----------------------------| :--- |
| **Приоритет**                | **Low** |
| **Шаги для воспроизведения** | 1. Открыть файл документации.<br>2. Найти эндпоинт `POST /api/1/item`.<br>3. Посмотреть поле `description` для ответа с кодом `200`. |
| **Фактический результат**    | В поле `description` указано "Success response". |
| **Ожидаемый результат**      | В поле `description` должно быть стандартное для HTTP-статуса 200 значение "OK". |
